{{# def.definitions }}
{{# def.errors }}
{{# def.setupKeyword }}
{{# def.setupNextLevel }}

var {{=$errs}} = errors;
var prevValid{{=$lvl}} = false;
var {{=$validCount}} = false;

{{ var $currentBaseId = $it.baseId; }}
{{# def.setCompositeRule }}

{{~ $schema:$sch:$i }}
  {{? {{# def.nonEmptySchema:$sch }} }}
    {{
      $it.schema = $sch;
      $it.schemaPath = $schemaPath + '[' + $i + ']';
      $it.errSchemaPath = $errSchemaPath + '/' + $i;
    }}

    {{# def.insertSubschemaCode }}
  {{??}}
    var validCount{{=$it.level}} = true;
  {{?}}

  {{? $i }}
    if (validCount{{=$it.level}} && prevValid{{=$lvl}})
      {{=$validCount}} = false;
    else {
    {{ $closingBraces += '}'; }}
  {{?}}

    if (validCount{{=$it.level}}) {{=$validCount}} = prevValid{{=$lvl}} = true;
{{~}}

{{# def.resetCompositeRule }}

{{= $closingBraces }}

if (!{{=$validCount}}) {
  {{# def.error:'oneOf' }}
} else {
  {{# def.resetErrors }}
{{? it.opts.allErrors }} } {{?}}
